<html>
<head>
  <title>list</title>
  <style type="text/css">
    #main {
      padding: 20px;
    }
  </style>
  <script>
      $(document).ready(function () {
          $('.task').click(function () {
              let record_id = $(this).attr('id');
              if (!$('#text_' + record_id).is(':empty')) {
                  $('#text_' + record_id).html('');
                  return;
              }
              $.get({
                  url: 'tasks/text/' + record_id,
                  success: function (data) {
                      $('#text_' + record_id).html(data.text);
                  },
              });
          });
      });
  </script>
</head>
<body>
<div align="right" id="main">
  <div><%= t :hello %>, <%= current_user.email %></div>
  <%= link_to t(:logout), destroy_user_session_path, method: :delete %>

  <%= content_tag :li do %>
    <%= link_to 'Switch to English', locale: :en %>
  <% end unless current_page? locale: :en %>

  <%= content_tag :li do %>
    <%= link_to 'Переключиться на русский', locale: :ru %>
  <% end unless current_page? locale: :ru %>


  <div class="row">
    <h3><%= t :add_task %></h3>
    <%= form_for @task do |f| %>
      <div class="form-group">
        <%= f.text_field :title, class: "form-control", placeholder: t(:task_name) %>
      </div>
      <div class="form-group">
        <%= f.text_area :text, class: "form-control", size: "40x4", placeholder: t(:description) %>
      </div>

      <%= f.submit t(:add_task), class: "pull-right", class: "btn btn-primary" %>
    <% end %>
  </div>
</div>
<hr>
<% @tasks.each do |t| %>
  <div class="row task" id="<%= t.id %>">
    <div class="panel panel-success">
      <div class="panel-body">
        <div class="col-md-7">
          <b><%= t.title %></b><br>
          <% if t.status %>
            <p class="text-success">
              <strong><%= t(:task_complete) %>.</strong>
            </p>
          <% end %>
          <p id="text_<%= t.id %>"></p>
        </div>
        <div class="col-md-4">
          <p class="text-right">
            <% unless t.status %>
              <%= link_to done_task_path(t.id), method: :patch do %>
                <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
              <% end %>
            <% end %>
            <%= link_to edit_task_path(t) do %>
              <span class="glyphicon glyphicon-pencil" aria-hidden="false"></span>
            <% end %>
            <%= link_to task_path(t), method: :delete, data: {confirm: t(:are_you_sure)} do %>
              <span class="glyphicon glyphicon-trash" aria-hidden="false"></span>
            <% end %>
          </p>
        </div>
      </div>
    </div>
  </div>

<% end %>
</body>
</html>